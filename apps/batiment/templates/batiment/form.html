{% extends "base.html" %}

{% block title %}Saisie B√¢timents - Bilan Carbone{% endblock %}

{% block content %}
<div class="container">
  <div class="page-header"
    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #dee2e6;">
    <h2 class="page-title" style="color: #2d6a4f; margin: 0; font-size: 1.75rem;">üè¢ Saisie B√¢timents & √ânergies</h2>
    <div style="display: flex; gap: 10px;">
      <a href="{% url 'batiment_list' %}" class="btn btn--secondary">
        üëÅÔ∏è Voir liste des donn√©es
      </a>
      <a href="{% url 'dashboard' %}" class="btn btn--secondary">
        üè† Retourner au dashboard
      </a>
    </div>
  </div>

  <div class="form-card">
    <div class="form-card__header">
      <h3>üìä Identification & Consommations</h3>
      <p class="form-card__description">
        Renseignez les d√©tails du b√¢timent et ses consommations annuelles.
        Le calcul carbone sera fait automatiquement selon les facteurs ADEME.
      </p>
    </div>

    <form method="post">
      {% csrf_token %}

      {% if form.non_field_errors %}
      <div class="alert alert--error">
        {{ form.non_field_errors }}
      </div>
      {% endif %}

      <div class="grid-form">
        <div class="section-title">üìç Identification</div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">{{ form.year.label }}</label>
            {{ form.year }}
          </div>
          <div class="form-group">
            <label class="form-label">{{ form.construction_year.label }}</label>
            {{ form.construction_year }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">{{ form.site_name.label }}</label>
          {{ form.site_name }}
        </div>

        <div class="form-group">
          <label class="form-label">{{ form.surface_area.label }} (m¬≤)</label>
          {{ form.surface_area }}
        </div>

        <div class="section-title">‚ö° √ânergies (kWh)</div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">üí° {{ form.electricity_kwh.label }}</label>
            {{ form.electricity_kwh }}
          </div>
          <div class="form-group">
            <label class="form-label">üî• {{ form.gas_kwh.label }}</label>
            {{ form.gas_kwh }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">‚ô®Ô∏è {{ form.heating_network_kwh.label }}</label>
            {{ form.heating_network_kwh }}
          </div>
          <div class="form-group">
            <label class="form-label">‚ùÑÔ∏è {{ form.cooling_kwh.label }}</label>
            {{ form.cooling_kwh }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">‚òÄÔ∏è {{ form.photovoltaic_production_kwh.label }}</label>
          {{ form.photovoltaic_production_kwh }}
          <small style="color: #6c757d; display: block; margin-top: 5px;">Production auto-consomm√©e ou r√©inject√©e (√†
            titre informatif)</small>
        </div>

        <div class="section-title">üìù Notes</div>
        <div class="form-group">
          {{ form.notes }}
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn--primary btn--large">
          üíæ Enregistrer
        </button>
        <a href="{% url 'dashboard' %}" class="btn btn--secondary">
          Annuler
        </a>
      </div>
    </form>
  </div>

  <!-- Info Box similar to vehicles -->
  <div class="info-box">
    <h4>üìñ Facteurs d'√©mission ADEME utilis√©s</h4>
    <table class="factors-table">
      <thead>
        <tr>
          <th>Type d'√©nergie</th>
          <th>Facteur</th>
          <th>Unit√©</th>
        </tr>
      </thead>
      <tbody>
        {% for factor in emission_factors %}
        <tr>
          <td>
            {% if factor.type_energie == 'ELEC' %}‚ö°
            {% elif factor.type_energie == 'GAZ' %}üî•
            {% elif factor.type_energie == 'HEAT' %}‚ô®Ô∏è
            {% elif factor.type_energie == 'COOL' %}‚ùÑÔ∏è
            {% else %}üîã{% endif %}
            {{ factor.get_type_energie_display }}
          </td>
          <td>{{ factor.facteur }}</td>
          <td>{{ factor.unit }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" style="text-align: center;">Aucun facteur d'√©mission d√©fini.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #dee2e6;
  }

  .page-title {
    color: #2d6a4f;
    margin: 0;
  }

  .form-card {
    background: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
  }

  .form-card__header {
    margin-bottom: 2rem;
    border-bottom: 1px solid #eee;
    padding-bottom: 1rem;
  }

  .form-card__header h3 {
    color: #2d6a4f;
    margin-bottom: 0.5rem;
  }

  .form-card__description {
    color: #6c757d;
    font-size: 0.9rem;
  }

  .section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2d6a4f;
    margin: 1.5rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e9ecef;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #212529;
  }

  .form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #eee;
  }

  .btn--large {
    padding: 0.8rem 1.5rem;
    font-size: 1.1rem;
  }

  .info-box {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 6px;
    border-left: 4px solid #2d6a4f;
  }

  .info-box h4 {
    color: #2d6a4f;
    margin-bottom: 0.5rem;
  }

  .info-box li {
    margin-bottom: 0.5rem;
    color: #495057;
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
      gap: 0;
    }

    .page-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }
  }
</style>
{% endblock %}